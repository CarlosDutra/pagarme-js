var PagarMe=PagarMe||{};!function(r,e){var a=function(r){return"[object Array]"===Object.prototype.toString.call(r)},t=function(r){return!a(r)&&r-parseFloat(r)+1>=0};r.Validator={getCardBrand:function(r){if(!r)return null;r=r.replace(/[^0-9]/g,"");for(var e=[["elo",["627780","636548","636117","637095","639350","627893","636368","438935","504175","451416","636297","5067","4576","4011"]],["discover",["6011","622","64","65"]],["hipercard",["384100","384140","384160","60"]],["diners",["301","305","36","38"]],["amex",["34","37"]],["aura",["50"]],["jcb",["35"]],["visa",["4"]],["mastercard",["5"]]],a=0;a<e.length;a++)for(var t=e[a][1],n=0;n<t.length;n++){var i=t[n];if(r.substring(0,i.length)==i)return e[a][0]}return"unknown"},isValidCardNumber:function(r){if(!r)return!1;r=r.replace(/[^0-9]/g,"");var e=parseInt(r.substring(r.length-1,r.length)),a=r.substring(0,r.length-1),t=0;for(i=0;i<a.length;i++)t+=parseInt(a.substring(i,i+1));var n=new Array(0,1,2,3,4,-4,-3,-2,-1,0);for(i=a.length-1;i>=0;i-=2){var o=parseInt(a.substring(i,i+1)),s=n[o];t+=s}var d=t%10;return d=10-d,10==d&&(d=0),d==parseInt(e)},isValidExpirationMonth:function(r){return r?t(r)?(r=parseInt(r),0>=r||r>12?!1:!0):!1:!1},isValidExpirationYear:function(r){return r?t(r)?(r=r.toString(),2!==r.length&&4!==r.length?!1:!0):!1:!1},isValidExpirationDate:function(r){if(r=r.replace("/",""),4!=r.length)return!1;var e=r.substring(0,2),a=r.substring(2,4),n=new Date,i=n.getFullYear()%1e3,o=n.getMonth()+1;return t(e)&&t(a)?i>a||a==i&&o>e?!1:(e=parseInt(e),12>=e&&e>0):!1},isValidCvv:function(r,e){return r&&t(r)?"amex"==e&&4!=r.length?!1:"amex"!=e&&3!=r.length?!1:!0:!1},isValidEmail:function(r){var e=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return e.test(r)},isValidCpf:function(r){if(r=r.replace(/[^0-9]+/g,""),11!=r.length)return!1;for(var e,a=0,t=0;9>t;t++)a+=parseInt(r.charAt(t))*(10-t);if(e=2>a%11?0:11-a%11,e!=parseInt(r.charAt(9)))return!1;a=0;for(var t=0;10>t;t++)a+=parseInt(r.charAt(t))*(11-t);return e=2>a%11?0:11-a%11,e!=parseInt(r.charAt(10))?!1:!0},isValidCnpj:function(r){if(r=r.replace(/[^0-9]+/g,""),14!=r.length)return!1;for(var e,a=0,t=[5,4,3,2,9,8,7,6,5,4,3,2],n=0;12>n;n++)a+=parseInt(r.charAt(n))*t[n];if(e=2>a%11?0:11-a%11,e!=parseInt(r.charAt(12)))return!1;a=0,t.unshift(6);for(var n=0;13>n;n++)a+=parseInt(r.charAt(n))*t[n];return e=2>a%11?0:11-a%11,e!=parseInt(r.charAt(13))?!1:!0},isValidDDD:function(r){return t(r)&&2==r.length},isValidPhoneNumber:function(r){return r=r.replace(/[^0-9]+/g,""),8!=r.length&&9!=r.length?!1:!0},isValidZipCode:function(r){return r=r.replace(/[^0-9]+/g,""),8==r.length}};var n=function(){var r=window.navigator.userAgent,e=r.indexOf("MSIE ");return e>0?parseInt(r.substring(e+5,r.indexOf(".",e))):0},o=function(r){var e=0;for(var a in r)r.hasOwnProperty(a)&&e++;return e},s=function(r,a){var t=new Date,n="pagarme_jsonp_"+t.getTime();e[n]=function(r){200==r.status&&a(r.body);try{delete e[n]}catch(t){e[n]=void 0}},r+=r.indexOf("?")>-1?"&callback="+n:"?callback="+n;var i=document.createElement("script");i.type="text/javascript",i.src=r,document.getElementsByTagName("head")[0].appendChild(i)},d=function(r,e){var a;a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status||304==a.status)&&e(JSON.parse(a.responseText))},a.open("GET",r,!0),a.send(null)},c=function(r,e){var a=n(),t="https://api.pagar.me/1";if(r.query=r.query||{},a&&9>=a){var i={};for(var o in r.query)i["query["+o+"]"]=r.query[o];i.method="get",i.path=encodeURIComponent(r.path);var c=t+"/jsonp"+u(i);s(c,e)}else{var c=t+r.path+u(r.query);d(c,e)}},u=function(r){return r&&o(r)?"?"+p(r):""},p=function(r){var e=[];for(var a in r)e.push(a+"="+unescape(encodeURIComponent(r[a])));return e.join("&")};r.CreditCard=function(){this.cardNumber=null,this.cardHolderName=null,this.cardExpirationMonth=null,this.cardExpirationYear=null,this.cardCVV=null},r.CreditCard.prototype.brand=function(){if(!this.cardNumber)return null;for(var r=this.cardNumber.replace(/[^0-9]/g,""),e=[["elo",["636368","438935","504175","451416","636297","5067","4576","4011"]],["discover",["6011","622","64","65"]],["diners",["301","305","36","38"]],["amex",["34","37"]],["aura",["50"]],["jcb",["35"]],["hipercard",["38","60"]],["visa",["4"]],["mastercard",["5"]]],a=0;a<e.length;a++)for(var t=e[a][1],n=0;n<t.length;n++){var i=t[n];if(r.substring(0,i.length)==i)return e[a][0]}return"unknown"},r.CreditCard.prototype.fieldErrors=function(){var e={};return r.Validator.isValidCardNumber(this.cardNumber)||(e.card_number="Número do cartão inválido."),this.cardHolderName&&0!=this.cardHolderName.length&&isNaN(this.cardHolderName)||(e.card_holder_name="Nome do portador inválido."),r.Validator.isValidExpirationMonth(this.cardExpirationMonth)||(e.card_expiration_month="Mês de expiração inválido."),r.Validator.isValidExpirationYear(this.cardExpirationYear)||(e.card_expiration_year="Ano de expiração inválido."),r.Validator.isValidCvv(this.cardCVV,this.brand())||(e.card_cvv="Código de segurança inválido."),e},r.CreditCard.prototype.stringifyParameters_=function(){var e={card_number:this.cardNumber,card_holder_name:this.cardHolderName,card_expiration_date:""+(1==this.cardExpirationMonth.length?"0":"")+this.cardExpirationMonth+(this.cardExpirationYear.length>2?this.cardExpirationYear.substr(-2):this.cardExpirationYear),card_cvv:this.cardCVV};r.sessionId&&(e.session_id=r.sessionId);var a=[];for(var t in e)a.push(t+"="+unescape(encodeURIComponent(e[t])));return a.join("&")},r.CreditCard.prototype.generateHash=function(e){if(!r.encryption_key)return alert("Erro: Você não configurou sua encryption_key. Por favor, sete a chave em PagarMe.encryption_key. Para mais informações, visite: https://pagar.me/docs/restful-api/card-hash/"),void 0;if("ak"==r.encryption_key.substring(0,2))return alert("Erro: Você está usando a api_key ao invés da encryption_key. Por favor, verifique se a chave inserida é a encryption_key disponível em seu dashboard. Para mais informações, visite: https://pagar.me/docs/restful-api/card-hash/"),void 0;var a=this.stringifyParameters_();c({path:"/transactions/card_hash_key",query:{encryption_key:encodeURIComponent(r.encryption_key)}},function(r){var t=new JSEncrypt;t.setPublicKey(r.public_key);var n=r.id+"_"+t.encrypt(a);e(n)})},r.creditCard=r.CreditCard,r.creditCard.prototype=r.CreditCard.prototype}(PagarMe,window);